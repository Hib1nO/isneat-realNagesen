:root{
  /* ====== Customize ====== */
  --bar-h: 66px;
  --radius: 999px;

  --left-color-a: #ff3bd4;  /* ピンク寄り */
  --left-color-b: #ff2b6a;

  --right-color-a: #3a8bff; /* ブルー寄り */
  --right-color-b: #2dd4ff;

  --bg: rgba(255,255,255,.14);
  --stroke: rgba(255,255,255,.22);

  --text: rgba(255,255,255,.95);
  --muted: rgba(255,255,255,.72);

  --shadow: 0 10px 26px rgba(0,0,0,.28);
  --glow-left: 0 0 18px rgba(255, 59, 212, .45);
  --glow-right: 0 0 18px rgba(45, 212, 255, .42);

  --sparkle-speed: 2.2s;
}

/* Demo背景（任意） */
body{
  margin:0;
  /* 背景透明 */
  /* background: transparent; */
  background: rgba(0,0,0, 1);
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial, sans-serif;
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

/* ====== Under Bar UI ====== */
.battle__under{
  margin-top: 10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 10px;
  position: relative;
  z-index: 3;
  flex-shrink: 0;
}

.battle__under-notices{
  display:flex;
  width:100%;
  align-items:center;
  height: var(--notice-h);
  min-height: var(--notice-h);
}

.battle__under-notice-left{
  display:flex;
  justify-content:center;
  align-items:center;
  width: 50%;
  height: 100%;
}

.battle__under-notice-right{
  display:flex;
  justify-content:center;
  align-items:center;
  width: 50%;
  height: 100%;
}

.battle__timer{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 7px 14px;
  border-radius: 999px;
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  font-weight: 900;
  font-size: 27px;
  line-height: 1;
  letter-spacing: .12em;
  font-variant-numeric: tabular-nums;
  text-shadow: 0 2px 10px rgba(0,0,0,.45);
}

/* ====== Battle Bar ====== */
.battle{
  padding-top: 3rem;
  max-width: none;
  width: 100%;
  height: 100vh;
  position: relative;
  filter: drop-shadow(var(--shadow));
  user-select:none;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

/* ====== Sequence Image Players ====== */
.sequence-players{
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  top: var(--bar-bottom, calc(var(--bar-h) + 80px));
  display: flex;
  z-index: 2;
  pointer-events: none;
}

/* ====== Video Players ====== */
.video-players{
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  top: var(--bar-bottom, calc(var(--bar-h) + 80px));
  display: flex;
  z-index: 1.5;
  pointer-events: none;
}

.video-player__element{
  width: 50%;
  height: 100%;
  object-fit: contain;
  background: rgba(0, 0, 0, 0.5);
  opacity: 1;
  transition: opacity 0.3s ease-out;
}

.sequence-player{
  width: 50%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

.sequence-player--left{
  left: 0;
}

.sequence-player--right{
  right: 0;
}

.sequence-player__canvas{
  position: absolute;
  top: 0;
  opacity: 1;
  transition: opacity 0.3s ease-out;
  left: 0;
  width: 100%;
  height: 100%;
}

.sequence-player__audio{
  display: none;
}

.battle__meta{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  margin-bottom:10px;
  gap:10px;
  flex-shrink: 0;
}

.side{
  display:flex;
  align-items:center;
  gap:10px;
  min-width: 0;
}

.avatar{
  width:102px;
  height:102px;
  border-radius: 999px;
  background: rgba(255,255,255,.18);
  border: 1px solid rgba(255,255,255,.22);
  position:relative;
  overflow:hidden;
}
.avatar::after{
  content:"";
  position:absolute;
  inset:-40%;
  background: linear-gradient(120deg, transparent 0 40%, rgba(255,255,255,.45) 50%, transparent 60% 100%);
  transform: rotate(15deg);
  animation: sheen 4.2s linear infinite;
  opacity:.55;
}
@keyframes sheen{
  from{ transform: translateX(-80%) rotate(15deg); }
  to  { transform: translateX(160%) rotate(15deg); }
}

.name{
  font-weight:700;
  font-size:27px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width: 180px;
}

.score{
  font-weight:800;
  font-size:19.5px;
  letter-spacing:.2px;
  opacity:.95;
}

.sub{
  display:block;
  font-size:18px;
  color: var(--muted);
  margin-top:2px;
  font-weight:600;
}

/* バー本体 */
.battle__bar{
  height: var(--bar-h);
  background: var(--bg);
  border: 1px solid var(--stroke);
  border-radius: var(--radius);
  position: relative;
  overflow:hidden;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1;
  flex-shrink: 0;
}

.fill{
  position:absolute;
  top:0; bottom:0;
  width: 50%;
  will-change: width;
  overflow: hidden;
}

.fill--left{
  left:0;
  background: linear-gradient(90deg, var(--left-color-a), var(--left-color-b));
  box-shadow: var(--glow-left);
}

.fill--right{
  right:0;
  background: linear-gradient(270deg, var(--right-color-a), var(--right-color-b));
  box-shadow: var(--glow-right);
}

/* 光沢レイヤー */
.battle__bar::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,0) 55%),
    radial-gradient(120px 40px at 25% 10%, rgba(255,255,255,.28), transparent 60%),
    radial-gradient(140px 44px at 75% 10%, rgba(255,255,255,.22), transparent 60%);
  opacity:.55;
  pointer-events:none;
}

/* バー内 連番画像エフェクト */
.bar-seq{
  position: absolute;
  inset: 0;
  width: 100%;
  opacity: 0;
  transition: opacity 120ms ease-out;
  pointer-events: none;
}

.bar-seq.is-visible{
  opacity: 1;
}

.bar-seq__canvas{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: 1;
  transition: opacity 0.3s ease-out;
}

/* キラッと走るハイライト */
.sparkle{
  position:absolute;
  inset:-40% 0 -40% 0;
  background: linear-gradient(120deg, transparent 0 40%, rgba(255,255,255,.55) 50%, transparent 60% 100%);
  transform: translateX(-120%) rotate(12deg);
  animation: sparkle var(--sparkle-speed) linear infinite;
  mix-blend-mode: overlay;
  opacity:.55;
  pointer-events:none;
}
@keyframes sparkle{
  0%   { transform: translateX(-120%) rotate(12deg); }
  100% { transform: translateX(120%) rotate(12deg); }
}

/* 中央 VS ピル */
.vs{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%, -50%);
  height: calc(var(--bar-h) + 10px);
  padding: 0 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(255,255,255,.22);
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:900;
  letter-spacing:.6px;
  text-transform: uppercase;
  box-shadow: 0 10px 22px rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.vs__dot{
  width:8px; height:8px;
  border-radius:999px;
  background: rgba(255,255,255,.7);
  box-shadow: 0 0 12px rgba(255,255,255,.35);
  animation: pulse 1.1s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{ transform: scale(1); opacity:.75; }
  50%{ transform: scale(1.35); opacity:1; }
}

/* バー上の数値 */
.battle__labels{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 0 12px;
  font-weight:800;
  font-size:12px;
  text-shadow: 0 1px 2px rgba(0,0,0,.45);
  pointer-events:none;
}

/* デモ用コントローラ（任意） */
.demo{
  margin-top:14px;
  display:flex;
  gap:12px;
  align-items:center;
  font-size:12px;
  color: var(--muted);
  position: fixed;
  bottom: 10px;
  left: 10px;
  right: 10px;
  z-index: 9999;
  background: rgba(0,0,0,0.8);
  padding: 10px;
  border-radius: 8px;
  max-height: 150px;
  overflow-y: auto;
  flex-wrap: wrap;
}
input[type="range"]{
  width: 220px;
  accent-color: rgba(255,255,255,.9);
}

/* ====== Notice ====== */
:root{
  --notice-h: 63px;
  --notice-pad-x: 27px;
  --notice-border: rgba(255,255,255,.16);
  --notice-shadow: 0 18px 40px rgba(0,0,0,.35);
  --notice-text: rgba(255,255,255,.95);
  --notice-em: #ffd76a;

  /* theme presets (dark / mid / bright) */
  --notice-bg-dark-a: #120b12;
  --notice-bg-dark-b: #2a0f21;
  --notice-bg-dark-start-end: #2e1024;
  --notice-bg-mid-a: #8a0c56;
  --notice-bg-mid-b: #b0106d;
  --notice-bg-mid-start-end: #7c1250;
  --notice-bg-bright-a: #cf1782;
  --notice-bg-bright-b: #e61991;
  --notice-bg-bright-start-end: #9e1264;
}

.noticeWrap{
  /* width is driven by JS for nice width animation */
  width: min(80vw, 720px);
  max-width: 80vw;
  height: var(--notice-h);
  font-variant-numeric: tabular-nums;
  opacity: 0;
  transform: scaleX(0);
  transform-origin: center;
  transition:
    opacity 240ms ease,
    transform 320ms cubic-bezier(.2,.9,.2,1),
    width 260ms cubic-bezier(.2,.9,.2,1);
  filter: drop-shadow(var(--notice-shadow));
  pointer-events:none;
}

#battleNoticeWrapLeft,
#battleNoticeWrapRight{
  /* width is driven by JS for nice width animation */
  width: min(40vw, 360px);
  max-width: 40vw;
  height: var(--notice-h);
  font-variant-numeric: tabular-nums;
  opacity: 0;
  transform: scaleX(0);
  transform-origin: center;
  transition:
    opacity 240ms ease,
    transform 320ms cubic-bezier(.2,.9,.2,1),
    width 260ms cubic-bezier(.2,.9,.2,1);
  filter: drop-shadow(var(--notice-shadow));
  pointer-events:none;
}

#battleNoticeWrapLeft.is-visible,
#battleNoticeWrapRight.is-visible{
  opacity: 1;
  transform: scaleX(1);
}

.noticeWrap.is-visible{ opacity: 1; transform: scaleX(1); }

.noticeCard{ position: relative; width: 100%; height: 100%; perspective: 900px; }
.noticeCard__faces{
  position:absolute; inset:0;
  transform-style: preserve-3d;
  transition: transform 520ms cubic-bezier(.2,.9,.2,1);
}
.noticeCard.is-flipped .noticeCard__faces{ transform: rotateX(180deg); }

.noticeFace{
  position:absolute; inset:0;
  overflow:visible;
  backface-visibility:hidden;
  display:flex; align-items:center; justify-content:center;
  color: var(--notice-text);
  pointer-events:none;
}
.noticeFace--bonus{ transform: rotateX(180deg); }

/* theme by data-theme — apply background to inner content so each face can size independently */
.noticeWrap[data-theme="dark"] .noticeFace__content{
  background: linear-gradient(90deg, var(--notice-bg-dark-start-end) 0%, var(--notice-bg-dark-a) 15%, var(--notice-bg-dark-b) 50%, var(--notice-bg-dark-a) 85%, var(--notice-bg-dark-start-end) 100%);
}
.noticeWrap[data-theme="mid"] .noticeFace__content{
  background: linear-gradient(90deg, var(--notice-bg-mid-start-end) 0%, var(--notice-bg-mid-a) 15%, var(--notice-bg-mid-b) 50%, var(--notice-bg-mid-a) 85%, var(--notice-bg-mid-start-end) 100%);
}
.noticeWrap[data-theme="bright"] .noticeFace__content{
  background: linear-gradient(90deg, var(--notice-bg-bright-start-end) 0%, var(--notice-bg-bright-a) 15%, var(--notice-bg-bright-b) 50%, var(--notice-bg-bright-a) 85%, var(--notice-bg-bright-start-end) 100%);
}

/* subtle gloss (moved to inner content) */
.noticeFace__content::before{
  content:"";
  position:absolute; inset:0;
  background:
    linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0) 55%),
    radial-gradient(160px 44px at 50% 5%, rgba(255,255,255,.14), transparent 62%);
  opacity: .55;
  pointer-events:none;
}

.noticeFace__content{
  position:relative;
  display:flex; align-items:center; justify-content:center;
  gap: 10px;
  padding: 0 var(--notice-pad-x);
  min-width: 0;
  height: var(--notice-h);
  border-radius: 999px;
  border: 1px solid var(--notice-border);
  overflow: hidden;
  width: max-content;
  box-sizing: border-box;
}
.notice__icon{
  width: 42px; height: 42px;
  display:flex; align-items:center; justify-content:center;
  flex: 0 0 42px;
  color: rgba(255,255,255,.92);
  filter: drop-shadow(0 2px 8px rgba(0,0,0,.25));
}
.notice__svg{ display:block; }
.notice__icon--spacer{
  /* keep visual spacer but don't affect layout flow so label stays centered */
  position: absolute;
  left: var(--notice-pad-x);
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 42px;
  opacity: 0;
  pointer-events: none;
}
.notice__spacer{ width: 33px; height: 33px; display:block; }

.marquee{
  flex: 1 1 auto;
  min-width: 0;
  height: 100%;
  overflow:hidden;
  white-space: nowrap;
  display:flex; align-items:center; justify-content:center;
}
.marquee__track{
  display:flex; align-items:center; justify-content:center;
  gap: 51px;
  will-change: transform;
  min-width: 100%;
  padding-left: var(--marquee-pad, 0px);
}

/* When marquee is active, align track to start so scrolling begins from the head */
.noticeFace.is-marquee .marquee__track{
  justify-content: flex-start;
}

/* Center each marquee item and its label */
.marquee__item{
  display:flex;
  align-items:center;
  justify-content:center;
}

/* hide the duplicated/empty second item when not animating to avoid layout offset */
.marquee__item[aria-hidden="true"]{
  display:none;
}
.noticeFace.is-marquee .marquee__item[aria-hidden="true"]{
  display:flex;
}

.noticeWrap .notice__label{
  display:inline-block;
  text-align:center;
}

.noticeWrap .notice__label{ 
  font-weight: 900; 
  font-size: 27px; 
  letter-spacing: .03em;
  text-align: center;
  width: max-content;
}
.noticeWrap .notice__sep{ font-weight: 900; font-size: 27px; opacity: .9; margin: 0 9px; }
.notice__em{
  color: var(--notice-em);
  font-weight: 950;
  font-size: 27px;
  margin-left: 9px;
  text-shadow: 0 2px 10px rgba(0,0,0,.35);
}

/* marquee mode (only when overflowing) */
.noticeWrap .noticeFace.is-marquee .marquee__track{
  animation: notice-marquee var(--marquee-dur, 10s) linear infinite;
  animation-delay: var(--marquee-delay, 0s);
  animation-fill-mode: both; /* keep the head frame during delay */
}
/* apply edge fade only when marquee is active to avoid clipping first/last chars */
/* center notice */
#battleNoticeWrap .noticeFace.is-marquee .marquee{
  -webkit-mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
          mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
}
/* left notice */
#battleNoticeWrapLeft .noticeFace.is-marquee .marquee{
  -webkit-mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
          mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
}
/* right notice */
#battleNoticeWrapRight .noticeFace.is-marquee .marquee{
  -webkit-mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
          mask-image: linear-gradient(90deg, transparent 0, #000 15px, #000 calc(100% - 15px), transparent 100%);
}
@keyframes notice-marquee{
  0% { transform: translateX(0); }
  100% { transform: translateX(calc(-1 * var(--marquee-shift, 240px))); }
}

@media (prefers-reduced-motion: reduce){
  .noticeWrap, .noticeCard__faces, .marquee__track{
    transition: none !important;
    animation: none !important;
  }
}